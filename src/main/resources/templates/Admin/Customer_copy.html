<!DOCTYPE html>
<html>

<head>
	<title>Hoteru Managerment</title>

	<meta name="viewport"
		content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<link rel="icon" type="image/png" th:href="@{/img/location.png}" />
	<!-- Import lib -->
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/Admin/fontawesome-free/css/all.min.css}">
	<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<!-- End import lib -->
	<link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" type="text/css">
	<script src="https://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" th:href="@{/Admin/style.css}">
</head>

<body class="overlay-scrollbar" onload="createnoti()">
	<!-- navbar -->
	<div class="navbar">
		<!-- nav left -->
		<ul class="navbar-nav">
			<li class="nav-item">
				<a class="nav-link">
					<i class="fas fa-bars" onclick="collapseSidebar()"></i>
				</a>
			</li>
			<li class="nav-item">
				<img th:src="@{/img/logo-black.png}" alt="Hoteru logo" class="logo logo-light">
				<img th:src="@{/img/logo.png}" alt="Hoteru logo" class="logo logo-dark">
			</li>
		</ul>
		<!-- end nav left -->
		<!-- form -->
		<!-- end form -->
		<!-- nav right -->
		<ul class="navbar-nav nav-right">
			<li class="nav-item mode">
				<a class="nav-link" href="#" onclick="switchTheme()">
					<i class="fas fa-moon dark-icon"></i>
					<i class="fas fa-sun light-icon"></i>
				</a>
			</li>
			<li class="nav-item dropdown">
				<a class="nav-link">
					<i class="fas fa-bell dropdown-toggle" data-toggle="notification-menu"></i>
					<span id="numberNoti" class="navbar-badge">0</span>
				</a>
				<ul id="notification-menu" class="dropdown-menu notification-menu">
					<div class="dropdown-menu-header">
						<span>
							Notifications
						</span>
					</div>
					<div id="notification" class="dropdown-menu-content overlay-scrollbar scrollbar-hover">

					</div>
				</ul>
			</li>
			<li class="nav-item avt-wrapper">
				<div class="avt dropdown">
					<img src="https://us.123rf.com/450wm/donets/donets1508/donets150800333/43440158-vector-user-icon-of-man-in-business-suit.jpg?ver=6"
						alt="User image" class="dropdown-toggle" data-toggle="user-menu">
					<ul id="user-menu" class="dropdown-menu">
						<li class="dropdown-menu-item">
							<a href="#" class="dropdown-menu-link">
								<div>
									<i class="fas fa-sign-out-alt"></i>
								</div>
								<span>Logout</span>
							</a>
						</li>
					</ul>
				</div>
			</li>
		</ul>
		<!-- end nav right -->
	</div>
	<!-- end navbar -->
	<!-- sidebar -->
	<div class="sidebar">
		<ul class="sidebar-nav">
			<li class="sidebar-nav-item">
				<a th:href="@{/admin/index}" class="sidebar-nav-link">
					<div>
						<i class="fas fa-tachometer-alt"></i>
					</div>
					<span>
						Dashboard
					</span>
				</a>
			</li>
			<li class="sidebar-nav-item">
				<a th:href="@{/admin/customermgmt}" class="sidebar-nav-link active ">
					<div>
						<i class="fas fa-users"></i>
					</div>
					<span>Customer Mgmt</span>
			</li>
			<li class="sidebar-nav-item">
				<a th:href="@{/admin/roommgmt}" class="sidebar-nav-link ">
					<div>
						<i class="fas fa-bed"></i>
					</div>
					<span>Rooms Mgmt</span>
				</a>
			</li>
			<li class="sidebar-nav-item">
				<a th:href="@{/admin/servicemgmt}" class="sidebar-nav-link">
					<div>
						<i class="fas fa-concierge-bell"></i>
					</div>
					<span>Services Mgmt</span>
				</a>
			</li>
			<li class="sidebar-nav-item">
				<a th:href="@{/admin/foodmgmt}" class="sidebar-nav-link">
					<div>
						<i class="fas fa-utensils"></i>
					</div>
					<span>Foods Mgmt</span>
				</a>
			</li>
			<li class="sidebar-nav-item">
				<a th:href="@{/admin/bookingmgmt}" class="sidebar-nav-link">
					<div>
						<i class="fas fa-chart-line"></i>
					</div>
					<span>Booking Mgmt</span>
				</a>
			</li>
		</ul>
	</div>
	<!-- end sidebar -->
	<!-- main content -->
	<div class="wrapper">
		<div class="row">
			<div class="col-12 col-m-12 col-sm-12">
				<div class="card">
					<div class="card-header">
						<h3>
							Customer Management
						</h3>
					</div>
					<div class="card-content">
						<div id="mgmtBody"></div>
					</div>
				</div>
				<div class="card-content col-12">
					<div class="col6"><center><img src="/img/FPT_Polytechnic.png" width="10%" height="10%"></center></div>
					<div class="col6" style="padding-top: 5px"><center>Copyright 2021 by FPT_Polytechnic. All Rights Reserved.</center></div>
				</div>
			</div>
		</div>
	</div>
	<!-- end main content -->
	<!-- import script -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
	<script th:src="@{/Admin/index.js}"></script>
	<!-- end import script -->
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
	webix.ready(async function () {
		await searchService();
		await webix.ui({
			"container": "mgmtBody",
			css: "container",
			autoheight: true,
			autowidth: true,
			"cols": [
				{
					rows: [
						{
							columns: [
								{ id: "username", "header": "USERNAME", "sort": "string", fillspace: 2 },
								{ id: "fullname", header: ["FULLNAME", { content: "textFilter" }], "sort": "string", fillspace: 5 },
								{ id: "role", "header": "ROLE", "sort": "string", fillspace: 2 },

							],
							"view": "datatable",
							id: "CustomerTable",
							select: true,
							scroll: "y",
							data: ListCustomers,
							width: 650,
							height: 500
						},
						{
							rows: [
								{
									"view": "button", id: "btnExport", "css": "webix_primary", "label": "Export Data",
									"borderless": 1, width: 100, click: function () {
										var key = $$("CustomerTable").getFilter("fullname").value;
										location.href = '/excel/customer?key=' + key;
										console.log(location.href = '/excel/customer?key=' + key);
									}
								},
							]
						},
					]
				},

				{

					"view": "form",
					id: "formCustomer",
					// "borderless": 1,
					autoheight: true,
					autowidth: true,
					"rows": [
						{ "view": "text", id: "txtUsr", "label": "UsrName", "name": "username", required: true },
						{ "view": "text", id: "txtPass", "label": "Pass", "name": "password", required: true },
						{ "view": "text", id: "txtFullname", "label": "Fullname", "name": "fullname", required: true },
						{ "view": "text", id: "txtPhone", "label": "Phone", "name": "phone", required: true },
						{ "view": "text", id: "txtEmail", "label": "Email", "name": "email" },
						{ "label": "Address", id: "txtAddress", "view": "textarea", name: "address", height: 60 },
						{
							view: "switch",
							label: "Is Admin?", labelWidth: 80,
							value: true,
							id: "role",
							onLabel: "ADMIN",
							offLabel: "USER"
						},
						{
							"cols": [
								{ "label": "New", id: "btnNew", "view": "button", "css": "webix_primary", "height": 0,  "borderless": 1, click: clearForm },
								{ "view": "button", id: "btnSave", "css": "webix_primary", "label": "Save", "borderless": 1, click: save },
								{ "label": "Update", id: "btnUpdate", "view": "button", "css": "webix_primary", "height": 0, "borderless": 1, click: save },
								{ "label": "Delete", id: "btnDelete", "view": "button", "css": "webix_primary", "height": 0,  "borderless": 1, click: deleteCustomer },
							]
						}
					],

				}
			]
		}
		);

		$$("formCustomer").bind("CustomerTable");

		$$("CustomerTable").attachEvent("onSelectChange", function () {
			var id = $$("txtUsr").getValue();
			axios.get("/api/cus/" + id).then(function (response) {
				let customer = response.data;
				console.log(customer)
				if (customer.role === "Admin") {
					$$("role").setValue(1);
				}
				else {
					$$("role").setValue(0);
				}

			})
		});

		setvalueButton();
	});

</script>


<!-- function -->
<script>
	let ListCustomers = [];
	function searchService() {
		axios.get('/api/Allcustomer')
			.then(function (response) {
				ListCustomers = response.data;
				$$("CustomerTable").parse(ListCustomers, "json");
			})
			.catch(function (error) {
				console.error(error)
			});
	}

	function setvalueButton() {
		$$("btnUpdate").disable();
		$$("btnDelete").disable();
		$$("btnNew").disable();

		$$("CustomerTable").attachEvent("onSelectChange", () => {
			$$("btnSave").disable();
			$$("btnUpdate").enable();
			$$("btnDelete").enable();
			$$("btnNew").enable();
		});
	}

	function clearForm() {
		$$("txtUsr").setValue("");
		$$("txtPass").setValue("");
		$$("txtFullname").setValue("");
		$$("txtPhone").setValue("");
		$$("txtEmail").setValue("");
		$$("txtAddress").setValue("");
		$$("role").setValue(0);
		$$("btnSave").enable();
		$$("btnUpdate").disable();
		$$("btnDelete").disable();
		$$("btnNew").disable();
	}

	function save() {
		const obj = {
			username: $$("txtUsr").getValue(),
			password: $$("txtPass").getValue(),
			fullname: $$("txtFullname").getValue(),
			phone: $$("txtPhone").getValue(),
			email: $$("txtEmail").getValue(),
			address: $$("txtAddress").getValue()
		}
		let role = $$("role").getValue();
		if (role === 1) {
			obj.role = "Admin"
		} else {
			obj.role = "Customer"
		}

		if (obj.username == "") {
			webix.alert({
				type: "alert-error",
				title: "Username can not be null!",
			});
		}
		else if (obj.password == "") {
			webix.alert({
				type: "alert-error",
				title: "Password can not be null!",
			});
		}
		else if (obj.fullname == "") {
			webix.alert({
				type: "alert-error",
				title: "Fullname can not be null!",
			});
		}
		else if (obj.phone == "") {
			webix.alert({
				type: "alert-error",
				title: "Phone can not be null!",
			});
		}
		else {
			axios.post('/api/insertCus', obj).then(function (response) {
				webix.alert({
					title: "Successfully!",
				}).then(function () {
					location.reload();
				});

			})
				.catch(function (error) {
					webix.alert({
						type: "alert-error",
						title: "An Error Occurred",
					});
				});
		}
	}

	function deleteCustomer() {
		webix.confirm({
			title: "Title",
			ok: "Yes", cancel: "No",
			text: "Are you sure to delete this?"
		})
			.then(function () {
				var id = $$("txtUsr").getValue();
				axios.get('/api/deleteCus/' + id)
					.then(function (response) {
						if (response.data == true) {
							webix.alert({
								title: "Successfully!",
							}).then(function () {
								location.reload();
							});
						}
					})
					.catch(function (error) {
						webix.alert({
							type: "alert-error",
							title: "An Error Occurred",
						});
					});
			})
			.fail(function () {

			});
	}

</script>
<script th:src="@{/Admin/notifacation.js}"></script>
</html>